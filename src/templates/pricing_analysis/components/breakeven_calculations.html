<!-- Break Even Calculations Component -->
<div class="card shadow-sm">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">
            <i class="bi bi-calculator"></i> Cálculos Break Even
        </h5>
    </div>
    <div class="card-body">
        <table class="table table-sm mb-0">
            <tbody>
                <tr>
                    <td><strong>Costo Base MXN:</strong></td>
                    <td class="text-end price-value">
                        {% if analysis.cost_base_mxn %}
                            ${{ analysis.cost_base_mxn.amount|floatformat:2 }} {{ analysis.cost_base_mxn.currency }}
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <small class="text-muted">
                            [(Precio Compra USA x TC x 1.0825) + (Fees Importacion 20%) + (IVA sobre Fees 16%)]
                        </small>
                    </td>
                </tr>

                <tr>
                    <td><strong>Fees importacion (20%):</strong></td>
                    <td class="text-end price-value">
                        {% if metrics.import_fees %}
                            +${{ metrics.import_fees|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td><strong>IVA fees importacion (16%):</strong></td>
                    <td class="text-end price-value">
                        {% if metrics.import_iva %}
                            +${{ metrics.import_iva|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td><strong>Total importacion:</strong></td>
                    <td class="text-end price-value">
                        {% if metrics.import_total %}
                            +${{ metrics.import_total|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr class="table-danger bg-opacity-25">
                    <td><strong>Retencion IVA (8%) - precio actual:</strong></td>
                    <td class="text-end text-danger price-value">
                        {% if metrics.retention_current_vat %}
                            ${{ metrics.retention_current_vat|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr class="table-danger bg-opacity-25">
                    <td><strong>Retencion ISR (2.5%) - precio actual:</strong></td>
                    <td class="text-end text-danger price-value">
                        {% if metrics.retention_current_isr %}
                            ${{ metrics.retention_current_isr|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td><strong>Total Retenciones (precio actual):</strong></td>
                    <td class="text-end text-danger fw-bold price-value">
                        {% if metrics.retention_current %}
                            ${{ metrics.retention_current|floatformat:2 }} MXN
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr class="table-info bg-opacity-25">
                    <td><strong>Costo de envío:</strong></td>
                    <td class="text-end text-primary price-value">
                        {% if analysis.shipping_cost_used %}
                            +${{ analysis.shipping_cost_used.amount|floatformat:2 }} {{ analysis.shipping_cost_used.currency }}
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td><strong>Fee Amazon (15%):</strong></td>
                    <td class="text-end">
                        <span class="badge bg-info">Incluido en Break Even</span>
                    </td>
                </tr>

                <tr class="table-warning border-top border-3">
                    <td><strong class="fs-5">BREAK EVEN PRICE:</strong></td>
                    <td class="text-end">
                        <span class="fs-4 fw-bold text-warning price-value">
                            {% if analysis.break_even_price %}
                                ${{ analysis.break_even_price.amount|floatformat:2 }} {{ analysis.break_even_price.currency }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card-footer bg-light">
        <small class="text-muted">
            <i class="bi bi-info-circle"></i>
            <strong>Fórmula Break Even:</strong><br>
            <code class="text-dark d-block mt-1">
                1. Costo Base = (Precio Compra USA x TC x 1.0825) + Fees Importacion + IVA Fees
            </code>
            <code class="text-dark d-block mt-1">
                2. Break Even Base = (Costo Base + Envío) / 0.85
            </code>
            <code class="text-dark d-block mt-1">
                3. Retenciones = (Precio Venta / 1.16) × (0.08 + 0.025)
            </code>
            <code class="text-dark d-block mt-1">
                4. Break Even Final = Break Even Base + Retenciones
            </code>
        </small>
    </div>
</div>
